<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>index (opium-testing.index)</title><link rel="stylesheet" href="../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ opium-testing</nav><h1 id="opium-testing"><a href="#opium-testing" class="anchor"></a>Opium Testing</h1><p><code>opium-testing</code> provides helpers to easily test Opium applications with Alcotest.</p><nav class="toc"><ul><li><a href="#installation">Installation</a></li><li><a href="#usage">Usage</a></li><li><a href="#api-documentation">API documentation</a></li></ul></nav></header><h2 id="installation"><a href="#installation" class="anchor"></a>Installation</h2><p>To install <code>opium-testing</code>, you can add it to your <code>dune-project</code>'s package stanza:</p> <pre>
(package
 (name my_app)
 (depends
  (ocaml
   (>= 4.08))
  (dune
   (>= 2.0))
  rock
  (alcotest :with-test)
  (alcotest-lwt :with-test)
  (opium-testing :with-test)))
</pre><p>And let Dune generate the Opam file for you. Or you can add it directly to your <code>.opam</code> file:</p> <pre>
depends: [
  "alcotest" {with-test}
  "alcotest-lwt" {with-test}
  "opium-testing" {with-test}
]
</pre><h2 id="usage"><a href="#usage" class="anchor"></a>Usage</h2><p>Here's a sample unit test that tests if the response is the one expected.</p><pre><code class="ml">open Alcotest
open Lwt.Syntax
open Rock
open Opium_testing

let test_case n f = Alcotest_lwt.test_case n `Quick (fun _switch () -&gt; f ())

let handle_request = handle_request My_app.app

let suite =
  [ ( &quot;POST /create-user&quot;
    , [ test_case &quot;redirects to show when data is valid&quot; (fun () -&gt;
            let req =
              Request.of_json
                ~body:(`Assoc [ &quot;name&quot;, `String &quot;Tom&quot; ])
                &quot;/create-user&quot;
                `POST
            in
            let+ res = handle_request req in
            check_status `Found res.status)
      ; test_case &quot;renders errors when data is invalid&quot; (fun () -&gt;
            let req =
              Request.of_json
                ~body:(`Assoc [ &quot;invalid-key&quot;, `String &quot;invald-value&quot; ])
                &quot;/create-user&quot;
                `POST
            in
            let+ res = handle_request req in
            check_status `Bad_request res.status;
            check_body_contains &quot;Invalid data&quot; res.body)
      ] )
  ]
;;

let () = Lwt_main.run @@ Alcotest_lwt.run &quot;User Handler&quot; suite</code></pre><h2 id="api-documentation"><a href="#api-documentation" class="anchor"></a>API documentation</h2><ul class="modules"><li><a href="Opium_testing/index.html"><code>Opium_testing</code></a></li></ul></div></body></html>